import{f as $,c as n,a as e,F as A,D as L,Q as _,o as a,t as d,r as m,G as b,q as E,g as M,n as V,d as J,y as t,b as U,P as W,H as F,I as q,J as z,C as G,E as D}from"./BHZ1H3K9.js";import{a as H}from"./C-J3qaBc.js";import{u as Q,_ as j}from"./DzZvkiI3.js";import{u as K}from"./CvP0EubP.js";import{f as X}from"./BPEdkUGn.js";const Y={key:0,class:"p-2 flex-col gap-2"},Z=e("span",{class:"text-[0.8rem]/[1rem]"},"Сечас в чате:",-1),ee={class:"p-2 border-2 border-slate-300/50"},te=$({__name:"clientsOnChat",props:{usersOnChat:{}},setup(g){const o=g;return(u,y)=>o.usersOnChat.length>0?(a(),n("div",Y,[Z,e("ul",ee,[(a(!0),n(A,null,L(o.usersOnChat,f=>(a(),n("li",{key:f.id,class:"p-1 text-green-700 odd:text-green-600 text-[0.9rem]/[1rem]"},d(f.name),1))),128))])])):_("",!0)}}),se={class:"container mx-auto grid grid-cols-1 xl:grid-cols-[20%_80%] gap-2 items-start"},ae={class:"text-sky-700 text-[0.8rem]/[1rem]"},oe={key:1,class:"w-full lg:w-[80%] mx-auto p-1"},le={class:"w-fit mx-auto mt-2"},re={class:"font-bold font-roboto"},ne={class:"w-full lg:w-[80%] mx-auto mt-10 h-[calc(50vh-5vh)] flex flex-col items-start gap-2 overflow-x-hidden overflow-y-auto"},ie=["id"],ce={class:"w-full p-1 font-roboto flex-auto"},ue={class:"w-fit ml-auto text-[0.6rem]/[1rem] text-sky-600"},me={class:"flex items-start gap-1"},de=e("button",{class:"p-2 w-fit h-[40px] rounded-lg bg-slate-800 text-white active:scale-90 text-[0.8rem]/[1rem]",type:"submit"}," Отправить ",-1),ge=$({__name:"Websocket.client",setup(g){const o=m([]),u=m(""),y=K(),f=Q(),{ClientMessage:l,getIsClient:S}=b(f),{setClientMessage:w}=f,{isAuth:O}=b(y),P=X(import.meta.url),R=m(`${P}api/myChat?new=all&user=${l.value.name}`),v=m(-1),x=m(),h=m([]),{send:N,data:T,status:i,open:B,close:fe}=H(R.value,{immediate:!0,autoReconnect:!0}),C=()=>{v.value>0&&(clearTimeout(v.value),v.value=-1),v.value=setTimeout(()=>{let r=document.getElementById(`${o.value.length-1}`);r==null||r.scrollIntoView(!1)},1e3)},I=()=>{w(u.value),i.value==="OPEN"&&(o.value.push(JSON.stringify(l.value)),N(JSON.stringify(l.value)),C()),u.value=""};E(T,r=>{if(i.value==="OPEN"){let c=JSON.parse(r);if(Array.isArray(c)&&c.length>0&&c[0].isFromServer){h.value=Array.from(c);return}let s=JSON.parse(r);s&&s.message.includes("Покинул чат")&&(h.value=h.value.filter(p=>p.id!==s.id)),o.value.push(r),C();return}}),E(S,()=>{S.value&&(w("Вошел в чат"),i.value==="CLOSED"&&B(),N(JSON.stringify(l.value)),o.value.push(JSON.stringify(l.value)))});function k(){x.value&&x.value.scrollIntoView(!1)}return M(()=>{window.addEventListener("scroll",k)}),V(()=>{window.removeEventListener("scroll",k)}),(r,c)=>(a(),n("div",se,[e("div",null,[e("span",null,[J("Статус: "),e("span",ae,d(t(i)==="OPEN"?"Подключено":"???"),1)]),U(te,{usersOnChat:t(h)},null,8,["usersOnChat"])]),t(i)==="CLOSED"&&!t(O)?(a(),W(j,{key:0})):_("",!0),t(i)==="OPEN"&&t(O)?(a(),n("section",oe,[e("h3",le,[e("span",re,d(t(l).name),1),J("! Добро пожаловать в Чат! ")]),e("div",ne,[(a(!0),n(A,null,L(t(o),(s,p)=>(a(),n("div",{key:p,class:D(["w-full p-2 rounded-xl flex flex-col items-start gap-4",JSON.parse(s).name.includes(t(l).name)?"text-sky-800 bg-green-100 text-left ":"bg-sky-100 text-sky-900"]),id:String(p)},[e("span",{class:D(["font-bold text-[0.8rem]/[1rem]",JSON.parse(s).name.includes(t(l).name)?"text-sky-950":"text-yellow-600"])},d(JSON.parse(s).name),3),e("div",ce,d(JSON.parse(s).message),1),e("span",ue,d(JSON.parse(s).messageDate),1)],10,ie))),128))]),t(i)==="OPEN"?(a(),n("div",{key:0,ref_key:"sectionRef",ref:x,class:"w-full lg:w-[80%] mx-auto p-1 mt-10"},[e("form",{action:"#",onSubmit:G(I,["prevent"])},[e("fieldset",me,[F(e("input",{class:"w-full p-2 outline-none border-2 border-slate-300/50 rounded-md placeholder:text-[0.75rem]/[1rem] placeholder:text-slate-400/60",type:"text",maxlength:"100",name:"textData",id:"textData","onUpdate:modelValue":c[0]||(c[0]=s=>z(u)?u.value=s:null),autocomplete:"off",placeholder:"не более 100 символов..."},null,512),[[q,t(u)]]),de])],32)],512)):_("",!0)])):_("",!0)]))}});export{ge as _};
